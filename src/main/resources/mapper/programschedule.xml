<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sg.silvergarden.dao.programcal.ProgramScheduleMapper">
    <update id="updateProgramSchedule" parameterType="java.util.Map">
        UPDATE PROGRAM_SCHEDULE2
        <set>
            <if test="PS_NAME != null">PS_NAME = #{PS_NAME},</if>
            <if test="PS_START != null">PS_START = TO_DATE(#{PS_START}, 'YYYY-MM-DD"T"HH24:MI:SS'),</if>
            <if test="PS_END != null">PS_END = TO_DATE(#{PS_END}, 'YYYY-MM-DD"T"HH24:MI:SS'),</if>
            MOD_DATE = TO_DATE(sysdate, 'YYYY-MM-DD"T"HH24:MI:SS')<if test="PS_INFO != null">,</if>
            <if test="PS_INFO != null">PS_INFO = #{PS_INFO},</if>
            <if test="REG_ID != null">REG_ID = #{REG_ID},</if>
            <if test="PS_CATEGORY != null">PS_CATEGORY = #{PS_CATEGORY}</if>
        </set>
        WHERE PS_NO2 = #{PS_NO2}
    </update>
    <select id="getProgramSchedule" resultType="java.util.Map">
        SELECT
            PS_NO2,--CRUD를 하는 PK키로 넣기
            PS_NAME,
            TO_CHAR(PS_START, 'YYYY-MM-DD"T"HH24:MI:SS') AS PS_START,
            TO_CHAR(PS_END, 'YYYY-MM-DD"T"HH24:MI:SS') AS PS_END,
            PS_INFO,
            PS_CATEGORY,
            REG_ID,
            TO_CHAR(MOD_DATE, 'YYYY-MM-DD"T"HH24:MI:SS') AS MOD_DATE,
            TO_CHAR(REG_DATE, 'YYYY-MM-DD"T"HH24:MI:SS') AS REG_DATE,
            --종류별로 컬러를 넣고 싶은 것으로 아래 case문 작성(색상 취향에 따라 선택)
            CASE
                --연보라/연핑크/연민트/기본 : 연초록
                WHEN PS_CATEGORY = '회의' THEN '#E0FFFF'
                WHEN PS_CATEGORY = '출장' THEN '#E6E6FA'
                WHEN PS_CATEGORY = '외근' THEN '#FFF0F5'
                ELSE '#6495ED'
                --#FFFFCC / #6495ED / #F0F8FF
            END AS COLOR
        FROM PROGRAM_SCHEDULE2
    </select>
    <insert id="addProgramSchedule" parameterType="java.util.Map">
        INSERT INTO PROGRAM_SCHEDULE2 (
            PS_NO2, PS_NAME, PS_START, PS_END, REG_DATE, PS_INFO, REG_ID)
        VALUES (
                PS_NO2_SEQUENCE.nextval,
                #{PS_NAME, jdbcType=VARCHAR},
                TO_DATE(#{PS_START},'YYYY-MM-DD"T"HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'),
                TO_DATE(#{PS_END},'YYYY-MM-DD"T"HH24:MI:SS', 'NLS_DATE_LANGUAGE=AMERICAN'),
                sysdate,
                #{PS_INFO, jdbcType=VARCHAR},
                #{REG_ID, jdbcType=VARCHAR}
                )
    </insert>
    <delete id="deleteProgramSchedule" parameterType="java.util.Map">
        DELETE FROM PROGRAM_SCHEDULE2 WHERE PS_NO2 = #{PS_NO2}
    </delete>
</mapper>
