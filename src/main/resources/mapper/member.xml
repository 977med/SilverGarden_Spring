<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.MemberMapper">
    <select id="memberList" resultType="java.util.Map">
        SELECT CLIENT_ID, CLIENT_NAME, CLIENT_BIRTH
        , CLIENT_GENDER, CLIENT_AGE, CLIENT_TEL
        , CLIENT_ADDRESS, CLIENT_MANAGER, CLIENT_PHOTO
        , CLIENT_PAGEID, CLIENT_PW
        , REG_ID, MOD_ID, REG_DATE, MOD_DATE
        FROM CLIENT
        <where>
            <if test="client_id!=null">AND CLIENT_ID=#{client_id}</if>
            <if test="gubun!=null">
                <choose>
                    <when test='gubun.equals("client_name")'>
                        AND CLIENT_NAME LIKE '%'||#{keyword}||'%'
                    </when>
                    <when test='gubun.equals("client_manager")'>
                        AND CLIENT_MANAGER LIKE '%'||#{keyword}||'%'
                    </when>
                </choose>
            </if>
        </where>
    </select>
    <delete id="memberDelete" parameterType="map">
        delete from CLIENT where CLIENT_ID =  #{CLIENT_ID}
    </delete>
    <update id="memberUpdate" parameterType="map">
        update CLIENT
        set
            CLIENT_NAME=#{CLIENT_NAME},
            CLIENT_BIRTH=TO_CHAR(#{CLIENT_BIRTH}),
            CLIENT_GENDER=#{CLIENT_GENDER},
            CLIENT_TEL=#{CLIENT_TEL},
            CLIENT_ADDRESS=#{CLIENT_ADDRESS},
            CLIENT_MANAGER=#{CLIENT_MANAGER},
            MOD_DATE=sysdate,
            MOD_ID=#{MOD_ID}
        where CLIENT_ID = #{CLIENT_ID}
    </update>
    <insert id="memberInsert" useGeneratedKeys="true" parameterType="map" keyColumn="CLIENT_ID" keyProperty ="CLIENT_ID">
        INSERT INTO CLIENT
        (CLIENT_ID, CLIENT_NAME, CLIENT_BIRTH, CLIENT_GENDER, CLIENT_TEL, CLIENT_ADDRESS, CLIENT_MANAGER, REG_ID, MOD_ID, REG_DATE, MOD_DATE)
        VALUES
            ((TO_CHAR(SYSDATE, 'YYMM_') || LPAD(SEQ_CLIENT_NO.nextval, 8, '0')),#{CLIENT_NAME},TO_CHAR(#{CLIENT_BIRTH}),#{CLIENT_GENDER},#{CLIENT_TEL},#{CLIENT_ADDRESS},#{CLIENT_MANAGER},#{REG_ID},#{MOD_ID},SYSDATE,SYSDATE)
    </insert>
<!--  상담관련   -->
    <select id="counselList" parameterType="map" resultType="map">
        SELECT
            co.COUNSEL_NO,TO_CHAR(COUNSEL_DATE, 'YYYY-MM-DD')
             ,co.COUNSEL_CONTENT,co.COUNSEL_TIME,co.COUNSEL_HOW,co.COUNSEL_STATUS
            ,co.CLIENT_ID,co.COUNSEL_MANAGER,co.REG_ID,co.MOD_ID,co.REG_DATE,co.MOD_DATE
        FROM
            COUNSEL co, CLIENT cl
        WHERE
             co.CLIENT_ID=cl.CLIENT_ID
    </select>
    <insert id="counselInsert" parameterType="map">
        INSERT INTO COUNSEL
        (COUNSEL_NO,COUNSEL_DATE,COUNSEL_HOW
        ,COUNSEL_TIME,COUNSEL_CONTENT,CLIENT_ID
        ,COUNSEL_MANAGER,REG_ID, MOD_ID, REG_DATE, MOD_DATE)
        VALUES
        (SEQ_COUNSEL_NO.nextval,TO_CHAR(#{COUNSEL_DATE}),#{COUNSEL_HOW}
        ,#{COUNSEL_TIME},#{COUNSEL_CONTENT},#{CLIENT_ID}
        ,#{COUNSEL_MANAGER},#{REG_ID},#{MOD_ID},SYSDATE,SYSDATE)
    </insert>
    <delete id ="consultDelete" parameterType="int">
        DELETE FROM COUNSEL
        WHERE COUNSEL_NO = #{COUNSEL_NO}
    </delete>
    <update id="counselUpdate" parameterType="map">
        update COUNSEL
        set
            COUNSEL_CONTENT=#{COUNSEL_CONTENT},
            COUNSEL_TIME=#{COUNSEL_TIME},
            COUNSEL_HOW=#{COUNSEL_HOW},
            COUNSEL_MANAGER=#{COUNSEL_MANAGER},
            MOD_DATE=sysdate,
            MOD_ID=#{MOD_ID}
        where CLIENT_ID = #{CLIENT_ID}
    </update>
</mapper>

